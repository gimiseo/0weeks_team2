<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WWL</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { background:#f6fbf9; }
    
    .fixed-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 35px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .wwl-label{ 
      font-size:30px; 
      font-weight:700; 
      color:#00c32e !important;
      text-decoration: none;
    }
    .top-menu {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 2000;
        display: flex;
        align-items: center;
    }
    .logout-text:hover {
        color: #ff3860;
    }
    .content-box {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .content-box img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .avatar-frame {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid #fff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, .2);
    }
    .post-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #f0f0f0;
    }
    .member-container {
      text-align: center;
      min-width: 80px;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: background-color 0.2s ease;
    }
    .member-container:hover {
      background-color: rgba(0, 195, 46, 0.1);
    }
    .avatar-frame {
      /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ + */
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .avatar-frame:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
    <!-- ìƒë‹¨ í†µí•© ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar is-white has-shadow is-fixed-top" style="z-index: 2000;">
        <div class="navbar-brand">
        <a class="navbar-item wwl-label" href="/main_page" style="cursor: pointer;">WeeklyWeLearned</a>
        </div>
        <div class="navbar-end">
        <div class="navbar-item">
            <div class="is-flex is-align-items-center">
            <!-- ì•Œë¦¼ ì•„ì´ì½˜ -->
            <div class="mr-3" style="position: relative;">
                <span id="notification-icon" class="icon is-large" style="cursor: pointer; font-size: 1.5rem;" onclick="toggleNotifications()">
                <i class="fas fa-bell"></i>
                </span>
                <span id="notification-badge" class="tag is-danger is-small" style="position: absolute; top: -5px; right: -5px; display: none; min-width: 20px; height: 20px; font-size: 12px; line-height: 1;">0</span>
            </div>
            
            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ì™€ ë‹‰ë„¤ì„ -->
            <div class="is-flex is-align-items-center mr-3" style="cursor: pointer;" onclick="window.location.href='/user/{{ current_user.username }}'">
                <div style="width: 32px; height: 32px; margin-right: 8px; background-image: url('/static/profile_imgs/{{ current_user.profile_img if current_user.profile_img else 'default-avatar.jpg' }}'); background-size: cover; background-position: center; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);"></div>
                <span class="has-text-weight-semibold">{{ current_user.nickname }}</span>
            </div>
            <span class="logout-text" onclick="window.location.href='/logout'" style="cursor: pointer; font-weight: 600; color: #363636;">ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>
        </div>
    </nav>

  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <section class="section" style="margin-top: 70px; padding-top: 1rem;">
    <div class="container">
      <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
      <div class="mb-3">
        <a href="javascript:history.back()" class="button is-small" style="background: none; border: none; box-shadow: none; padding-left: 0;">
          <span class="icon">
            <i class="fas fa-arrow-left"></i>
          </span>
          <span>ë’¤ë¡œê°€ê¸°</span>
        </a>
      </div>
      
      <!-- íŒ€ ì •ë³´ í‘œì‹œ -->
      <h1 class="title is-3">{{ team.teamName }}</h1>
      <div class="subtitle is-6 mb-4">Week {{ team.week }} Â· {{ team.description }}</div>
      
      <!-- ì¶”ì²œ ë²„íŠ¼ ë° ì¶”ì²œ ìˆ˜ -->
      <div class="is-flex is-align-items-center mb-4">
        {% if team.has_upvoted %}
        <button class="button is-light is-small" disabled>
          <span class="icon">
            <i class="fas fa-thumbs-up"></i>
          </span>
          <span>ì¶”ì²œë¨</span>
        </button>
        {% else %}
        <button class="button is-light is-small" onclick="handleTeamLike(this)">
          <span class="icon">
            <i class="fas fa-thumbs-up"></i>
          </span>
          <span>ì¶”ì²œ</span>
        </button>
        {% endif %}
        <span class="ml-2 has-text-grey is-size-7">ì¶”ì²œ <span class="team-like-count">{{ team.upvote }}</span>ê°œ</span>
      </div>
      
      <!-- íŒ€ ë©¤ë²„ ì‚¬ì§„ ë° ì´ë¦„ -->
      <div class="is-flex mb-4" style="flex-wrap: wrap; gap: 20px;">
        {% for member in team.members %}
        <div class="member-container" onclick="window.location.href='/user/{{ member.username }}'">
          <div class="avatar-frame" 
              style="background-image:url('{{ '/static/profile_imgs/' + member.profile_img if member.profile_img else '/static/images/default-avatar.jpg' }}'); width: 60px; height: 60px; margin: 0 auto; {% if member.role == 'master' %}border-color: #ff9800;{% endif %}">
          </div>
          <p class="member-nickname">{{ member.nickname }}</p>
          <div style="height: 24px; display: flex; align-items: center; justify-content: center;">
            {% if member.role == 'master' %}
            <span class="tag is-small is-warning">íŒ€ì¥</span>
            {% elif member.role == 'admin' %}
            <span class="tag is-small is-primary">ê´€ë¦¬ì</span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      
      <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
      <div class="mb-4">
        {% if is_member %}
        <a href="/team_post_write/{{ team.id }}" class="button is-success">
          <span class="icon is-small">
            <i class="fas fa-plus"></i>
          </span>
          <span>ê¸€ ì‘ì„±</span>
        </a>
        {% else %}
        <a href="/team_join/{{ team.id }}" class="button is-info">
          <span class="icon is-small">
            <i class="fas fa-user-plus"></i>
          </span>
          <span>íŒ€ ê°€ì…</span>
        </a>
        {% endif %}
      </div>
      
      <!-- ì‘ì„±ëœ ê¸€ í‘œì‹œ -->
      {% if team.posts %}
        {% for post in team.posts %}
        <div class="box" style="position: relative;">
          <article class="media">
            <div class="media-content">
            <div class="content">
                <div class="mb-3">
                <div class="mb-2">
                    <span class="title is-4">{{ post.title }}</span>
                    <span class="title is-6 has-text-grey-light mx-2">-</span>
                    <span class="has-text-weight-semibold is-size-6">{{ post.author }}</span>
                </div>
                <div>
                    <span class="has-text-grey is-size-6">{{ post.createdAt.strftime('%Y-%m-%d %H:%M') if post.createdAt else '' }}</span>
                </div>
                </div>
                <div>
                {{ post.content | safe }}
                </div>
                
                <!-- í¬ìŠ¤íŠ¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ (ì¢‹ì•„ìš”, ìˆ˜ì •, ì‚­ì œ) -->
                <div class="post-actions">
                  <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
                  <div class="is-flex is-align-items-center">
                    {% if post.has_liked %}
                    <button class="button is-light is-small" disabled>
                      <span class="icon is-small">
                        <i class="fas fa-heart" style="color: #ff3860;"></i>
                      </span>
                      <span>ì¢‹ì•„ìš”ë¨</span>
                    </button>
                    {% else %}
                    <button class="button is-light is-small" onclick="handlePostLike(this, '{{ post.id }}')">
                      <span class="icon is-small">
                        <i class="fas fa-heart"></i>
                      </span>
                      <span>ì¢‹ì•„ìš”</span>
                    </button>
                    {% endif %}
                    <span class="ml-2 has-text-grey is-size-7">ì¢‹ì•„ìš” <span class="post-like-count">{{ post.likes }}</span>ê°œ</span>
                  </div>
                  
                  <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
                  {% if post.can_edit or post.can_delete %}
                  <div class="buttons">
                    <!-- Edit button - only show if user can edit -->
                    {% if post.can_edit %}
                    <a href="/edit_post?post_id={{ post.id }}&team_id={{ team.id }}" 
                      class="button is-info is-small">
                      <span class="icon is-small">
                        <i class="fas fa-edit"></i>
                      </span>
                      <span>ìˆ˜ì •</span>
                    </a>
                    {% endif %}
                    
                    <!-- Delete button - only show if user can delete -->
                    {% if post.can_delete %}
                    <form method="POST" action="/delete_post" style="display: inline;">
                      <input type="hidden" name="post_id" value="{{ post.id }}">
                      <input type="hidden" name="team_id" value="{{ team.id }}">
                      <button type="submit" class="button is-danger is-small" 
                              onclick="return confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                        <span class="icon is-small">
                          <i class="fas fa-trash"></i>
                        </span>
                        <span>ì‚­ì œ</span>
                      </button>
                    </form>
                    {% endif %}
                  </div>
                  {% endif %}
                </div>

                <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
                <div class="mt-4">
                  <h4 class="title is-6">ëŒ“ê¸€ <span class="has-text-grey is-size-7">({{ post.comments | length }}ê°œ)</span></h4>
                  
                  <!-- ê¸°ì¡´ ëŒ“ê¸€ë“¤ í‘œì‹œ -->
                  <div class="comments-list" id="comments-{{ loop.index }}">
                    {% if post.comments %}
                      {% for comment in post.comments %}
                      <div class="comment-item mb-3 p-3 {{ 'ml-4' if comment.get('isReply') else '' }}" 
                          style="background: {{ '#f0f8ff' if comment.get('isReply') else '#f8f9fa' }}; border-radius: 8px; border-left: 3px solid {{ '#007bff' if comment.get('isReply') else '#00c32e' }};"
                          id="comment-{{ comment._id }}">
                        <div class="is-flex is-justify-content-between is-align-items-start">
                          <div style="flex: 1;">
                            {% if comment.get('isReply') %}
                            <p class="has-text-info is-size-7 mb-1">
                              <i class="fas fa-reply mr-1"></i>ëŒ€ëŒ“ê¸€
                            </p>
                            {% endif %}
                            <p class="has-text-weight-semibold is-size-7">{{ comment.author }}</p>
                            <div class="comment-content mt-1" id="comment-content-{{ comment._id }}">
                              <p>{{ comment.content }}</p>
                            </div>
                            <!-- ìˆ˜ì • í¼ (ìˆ¨ê¹€) -->
                            <div class="comment-edit-form mt-1" id="edit-form-{{ comment._id }}" style="display: none;">
                              <div class="field has-addons">
                                <div class="control is-expanded">
                                  <input class="input is-small" type="text" value="{{ comment.content }}" 
                                        id="edit-input-{{ comment._id }}">
                                </div>
                                <div class="control">
                                  <button class="button is-success is-small" 
                                          onclick="saveCommentEdit('{{ comment._id }}', '{{ post.title }}', '{{ team.id }}')">
                                    ì €ì¥
                                  </button>
                                </div>
                                <div class="control">
                                  <button class="button is-light is-small" 
                                          onclick="cancelCommentEdit('{{ comment._id }}')">
                                    ì·¨ì†Œ
                                  </button>
                                </div>
                              </div>
                            </div>
                            <!-- ëŒ“ê¸€ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                            <div class="comment-actions mt-2" style="font-size: 12px;">
                              {% if not comment.get('isReply') %}
                              <button class="button is-text is-small" style="padding: 2px 6px; height: auto;" 
                                      onclick="showReplyForm('{{ comment._id }}')">
                                <span class="icon is-small">
                                  <i class="fas fa-reply"></i>
                                </span>
                                <span>ëŒ€ëŒ“ê¸€</span>
                              </button>
                              {% endif %}
                              
                              {% if comment.authorId == current_user._id %}
                              <button class="button is-text is-small" style="padding: 2px 6px; height: auto;" 
                                      onclick="editComment('{{ comment._id }}')">
                                <span class="icon is-small">
                                  <i class="fas fa-edit"></i>
                                </span>
                                <span>ìˆ˜ì •</span>
                              </button>
                              {% endif %}
                              
                              <!-- ì‚­ì œ ë²„íŠ¼: ë³¸ì¸ì´ ì‘ì„±í•œ ëŒ“ê¸€ì´ê±°ë‚˜ íŒ€ ë§ˆìŠ¤í„°ì¸ ê²½ìš° í‘œì‹œ -->
                              {% if comment.authorId == current_user._id or is_master %}
                              <button class="button is-text has-text-danger is-small" style="padding: 2px 6px; height: auto;" 
                                      onclick="deleteComment('{{ comment._id }}', '{{ post.title }}', '{{ team.id }}')">
                                <span class="icon is-small">
                                  <i class="fas fa-trash"></i>
                                </span>
                                <span>ì‚­ì œ</span>
                              </button>
                              {% endif %}
                            </div>
                            
                            <!-- ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ (ìˆ¨ê¹€) -->
                            {% if not comment.get('isReply') %}
                            <div class="reply-form mt-2" id="reply-form-{{ comment._id }}" style="display: none;">
                              <div class="field has-addons">
                                <div class="control is-expanded">
                                  <input class="input is-small" type="text" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                                        id="reply-input-{{ comment._id }}" 
                                        onkeypress="handleReplyKeyPress(event, '{{ comment._id }}', '{{ post.title }}', '{{ team.id }}')">
                                </div>
                                <div class="control">
                                  <button class="button is-primary is-small" 
                                          onclick="addReply('{{ comment._id }}', '{{ post.title }}', '{{ team.id }}')">
                                    <span class="icon is-small">
                                      <i class="fas fa-paper-plane"></i>
                                    </span>
                                  </button>
                                </div>
                                <div class="control">
                                  <button class="button is-light is-small" 
                                          onclick="hideReplyForm('{{ comment._id }}')">
                                    ì·¨ì†Œ
                                  </button>
                                </div>
                              </div>
                            </div>
                            {% endif %}
                          </div>
                          <span class="has-text-grey is-size-7">{{ comment.createdAt.strftime('%m/%d %H:%M') if comment.createdAt else '' }}</span>
                        </div>
                      </div>
                      {% endfor %}
                    {% else %}
                      <p class="has-text-grey is-size-7">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endif %}
                  </div>
                  
                  <!-- ëŒ“ê¸€ ì‘ì„± í¼ (ëª¨ë“  ë¡œê·¸ì¸ ì‚¬ìš©ì) -->
                  <div class="mt-3">
                    <div class="field has-addons">
                      <div class="control is-expanded">
                        <input class="input is-small" type="text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                              id="comment-input-{{ loop.index }}" 
                              onkeypress="handleCommentKeyPress(event, '{{ post.title }}', '{{ team.id }}', {{ loop.index }})">
                      </div>
                      <div class="control">
                        <button class="button is-primary is-small" 
                                onclick="addComment('{{ post.title }}', '{{ team.id }}', {{ loop.index }})">
                          <span class="icon is-small">
                            <i class="fas fa-paper-plane"></i>
                          </span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </article>
        </div>
        {% endfor %}
      {% else %}
        <div class="content-box has-text-centered" style="padding: 40px;">
          <p class="has-text-grey is-size-5">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          {% if is_member %}
          <p class="has-text-grey">ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
          {% else %}
          <p class="has-text-grey">íŒ€ì— ê°€ì…í•˜ì—¬ ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </section>

  <script>
    // WWL ë¼ë²¨ í´ë¦­ ì²˜ë¦¬ í•¨ìˆ˜
    function handleWWLClick() {
        if (window.location.pathname === '/main_page') {
            window.location.reload();
        } else {
            window.location.href = '/main_page';
        }
    }

    // íŒ€ ì¢‹ì•„ìš” ê¸°ëŠ¥
    function handleTeamLike(button) {
      // AJAX ìš”ì²­ìœ¼ë¡œ ì„œë²„ì— ì¶”ì²œ ìš”ì²­ ë³´ë‚´ê¸°
      fetch('/team_upvote', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `team_id={{ team.id }}`
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // UI ì—…ë°ì´íŠ¸
          const likeCountSpan = document.querySelector('.team-like-count');
          likeCountSpan.textContent = data.new_upvote_count;
          
          // ë²„íŠ¼ ë¹„í™œì„±í™”
          button.disabled = true;
          button.innerHTML = '<span class="icon"><i class="fas fa-thumbs-up"></i></span><span>ì¶”ì²œë¨</span>';
          button.className = 'button is-light is-small';
        } else {
          alert(data.error || 'ì¶”ì²œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ì¶”ì²œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // í¬ìŠ¤íŠ¸ ì¢‹ì•„ìš” ê¸°ëŠ¥
    function handlePostLike(button, postId) {
      // AJAX ìš”ì²­ìœ¼ë¡œ ì„œë²„ì— ì¢‹ì•„ìš” ìš”ì²­ ë³´ë‚´ê¸°
      fetch('/post_like', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `team_id={{ team.id }}&post_id=${postId}`
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // UI ì—…ë°ì´íŠ¸
          const likeCountSpan = button.parentElement.querySelector('.post-like-count');
          likeCountSpan.textContent = data.new_like_count;
          
          // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ìŠ¤íƒ€ì¼ ë³€ê²½
          button.disabled = true;
          button.innerHTML = '<span class="icon is-small"><i class="fas fa-heart" style="color: #ff3860;"></i></span><span>ì¢‹ì•„ìš”ë¨</span>';
          button.className = 'button is-light is-small';
        } else {
          alert(data.error || 'ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // ëŒ“ê¸€ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function handleCommentKeyPress(event, postTitle, teamId, postIndex) {
      if (event.key === 'Enter') {
        addComment(postTitle, teamId, postIndex);
      }
    }

    function addComment(postTitle, teamId, postIndex) {
      const input = document.getElementById(`comment-input-${postIndex}`);
      const content = input.value.trim();
      
      if (!content) {
        alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      fetch('/add_comment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          post_title: postTitle,
          team_id: teamId,
          comment_content: content
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ğŸ‘‰ ì„±ê³µí•˜ë©´ ê·¸ëƒ¥ ìƒˆë¡œê³ ì¹¨
          location.reload();
        } else {
          alert(data.error || 'ëŒ“ê¸€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ëŒ“ê¸€ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // ëŒ“ê¸€ ìˆ˜ì • ê´€ë ¨ í•¨ìˆ˜ë“¤
    function editComment(commentId) {
      // ëŒ“ê¸€ ë‚´ìš© ìˆ¨ê¸°ê³  ìˆ˜ì • í¼ í‘œì‹œ
      document.getElementById(`comment-content-${commentId}`).style.display = 'none';
      document.getElementById(`edit-form-${commentId}`).style.display = 'block';
    }

    function cancelCommentEdit(commentId) {
      // ìˆ˜ì • í¼ ìˆ¨ê¸°ê³  ëŒ“ê¸€ ë‚´ìš© í‘œì‹œ
      document.getElementById(`comment-content-${commentId}`).style.display = 'block';
      document.getElementById(`edit-form-${commentId}`).style.display = 'none';
    }

    function saveCommentEdit(commentId, postTitle, teamId) {
      const newContent = document.getElementById(`edit-input-${commentId}`).value.trim();
      
      if (!newContent) {
        alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      fetch('/edit_comment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          team_id: teamId,
          post_title: postTitle,
          comment_id: commentId,
          new_content: newContent
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ğŸ‘‰ ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
          location.reload();
        } else {
          alert(data.error || 'ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ëŒ“ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    function deleteComment(commentId, postTitle, teamId) {
      if (!confirm('ì •ë§ë¡œ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë‹µëŒ“ê¸€ì´ ìˆë‹¤ë©´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)')) {
        return;
      }

      fetch('/delete_comment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          team_id: teamId,
          post_title: postTitle,
          comment_id: commentId
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬ (ë°±ì—”ë“œì—ì„œ ì´ë¯¸ ì •í™•íˆ ì²˜ë¦¬ë¨)
          if (data.message) {
            alert(data.message);
          }
          location.reload();
        } else {
          alert(data.error || 'ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // ë‹µëŒ“ê¸€ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function showReplyForm(commentId) {
      document.getElementById(`reply-form-${commentId}`).style.display = 'block';
      document.getElementById(`reply-input-${commentId}`).focus();
    }

    function hideReplyForm(commentId) {
      document.getElementById(`reply-form-${commentId}`).style.display = 'none';
      document.getElementById(`reply-input-${commentId}`).value = '';
    }

    function handleReplyKeyPress(event, commentId, postTitle, teamId) {
      if (event.key === 'Enter') {
        addReply(commentId, postTitle, teamId);
      }
    }

    function addReply(parentCommentId, postTitle, teamId) {
      const input = document.getElementById(`reply-input-${parentCommentId}`);
      const content = input.value.trim();
      
      if (!content) {
        alert('ë‹µëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      fetch('/add_reply', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          team_id: teamId,
          post_title: postTitle,
          parent_comment_id: parentCommentId,
          reply_content: content
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ğŸ‘‰ ì„±ê³µí•˜ë©´ ê·¸ëƒ¥ ìƒˆë¡œê³ ì¹¨
          location.reload();
        } else {
          alert(data.error || 'ë‹µëŒ“ê¸€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ë‹µëŒ“ê¸€ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }
  </script>
</body>
</html>