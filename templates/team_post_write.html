<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WWL</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
  <style>
    body { 
      background:#f6fbf9; 
    }
    .wwl-label { 
        position: fixed;
        top: 10px;
        left: 16px;
        z-index: 2000;
        font-size: 30px;
        font-weight: 700;
        color: #00c32e;
        cursor: pointer;
    }
    .top-menu {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 2000;
        display: flex;
        align-items: center;
    }
    .logout-text {
        margin-left: 8px;
        font-weight: 600;
        color: #363636;
        cursor: pointer;
    }
    .logout-text:hover {
        color: #ff3860;
    }
    .avatar-frame{ 
      width:72px; height:72px; border-radius:50%; 
      background-size:cover; background-position:center; 
      border:3px solid #fff; 
      box-shadow:0 2px 8px rgba(0,0,0,.2); 
    }
    .note-editor.note-frame {
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
    }
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìƒë‹¨ ë§ˆì§„ */
    .section {
        margin-top: 80px;
        padding-top: 1rem;
    }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ë©”ë‰´ -->
  <div class="wwl-label" onclick="handleWWLClick()">WeeklyWeLearned</div>
  <div class="top-menu">
      <div class="user-profile-btn" onclick="window.location.href='/my_page'" style="display: flex; align-items: center; cursor: pointer; padding: 8px 12px; background: #e8f5e8; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-right: 10px;">
          <div class="avatar-frame" style="width: 32px !important; height: 32px !important; border: 3px solid #fff !important; background-image: url('{{ '/static/profile_imgs/' + current_user.profile_img if current_user.profile_img else '/static/images/default-avatar.jpg' }}'); margin-right: 8px;"></div>
          <span style="font-size: 14px; font-weight: 500; color: #363636;">{{ current_user.nickname }}</span>
      </div>
      <span class="logout-text" onclick="window.location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</span>
  </div>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <section class="section">
    <div class="container">
      
      <!-- íŒ€ í—¤ë” -->
      <div class="box">
        <h1 class="title is-3">{{ team.teamName }}</h1>
        <p class="subtitle is-5 has-text-grey">{{ team.description }}</p>
        <div class="is-flex is-align-items-center" style="flex-wrap: wrap; gap: 16px;">
          {% for member in team.members[:3] %}
          <div class="avatar-frame mr-3" 
               style="background-image:url('{{ '/static/profile_imgs/' + member.profile_img if member.profile_img else '/static/images/default-avatar.jpg' }}'); {% if member.role == 'master' %}border-color: #ff9800;{% endif %}">
          </div>
          {% endfor %}
          {% if team.members|length > 3 %}
          <span class="has-text-grey">ì™¸ {{ team.members|length - 3 }}ëª…</span>
          {% endif %}
        </div>
      </div>

      <!-- íŒ€ ì •ë³´ -->
      <div class="box mb-5">
        <div class="field">
            <label class="label">ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ</label>
        <div class="file has-name is-boxed">
            <label class="file-label">
                <input class="file-input" type="file" name="team_file" id="teamFile">
                <span class="file-cta">
                    <span class="file-icon">
                        ğŸ“
                    </span>
                    <span class="file-label">íŒŒì¼ ì„ íƒ</span>
                </span>
                <span class="file-name" id="fileName">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
            </label>
        </div>
  </div>
</div>

      <!-- ê¸€ì“°ê¸° ì—ë””í„° -->
      <div class="box">
        <h2 class="title is-4 mb-3">íŒ€ ë¸”ë¡œê·¸ ê¸€ì“°ê¸°</h2>
        <form method="POST" action="/team_post_write/{{ team.id }}" enctype="multipart/form-data">
          <div class="field">
            <label class="label">ì‘ì„±ì</label>
            <div class="control">
              <input class="input" type="text" name="author" value="{{ current_user.nickname }}" readonly>
            </div>
          </div>
          <div class="field">
            <label class="label">ì œëª©</label>
            <div class="control">
              <input class="input" type="text" name="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
          </div>
          <div class="field">
            <label class="label">ë‚´ìš©</label>
            <textarea id="editor" name="content"></textarea>
          </div>
          <div class="control">
            <button class="button is-success mt-3" type="submit">ì €ì¥í•˜ê¸°</button>
          </div>
        </form>
      </div>

    </div>
  </section>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
  <script>
    // WWL ë¼ë²¨ í´ë¦­ ì²˜ë¦¬ í•¨ìˆ˜
    function handleWWLClick() {
        if (window.location.pathname === '/main_page') {
            window.location.reload();
        } else {
            window.location.href = '/main_page';
        }
    }

    $(document).ready(function() {
      $('#editor').summernote({
        height: 400,
        toolbar: [
          ['style', ['bold', 'italic', 'underline', 'clear']],
          ['font', ['strikethrough', 'superscript', 'subscript']],
          ['fontsize', ['fontsize']],
          ['color', ['color']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['height', ['height']],
          ['insert', ['link', 'picture', 'video']],
          ['view', ['fullscreen', 'codeview', 'help']]
        ],
        callbacks: {
          onImageUpload: function(files) {
            const formData = new FormData();
            formData.append('image', files[0]);

            // ì„œë²„ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ ìš”ì²­
            $.ajax({
              url: '/upload_image',
              method: 'POST',
              data: formData,
              contentType: false,
              processData: false,
              success: function(data) {
                // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URLì„ ì—ë””í„°ì— ì‚½ì…
                $('#editor').summernote('insertImage', data.url);
              },
              error: function() {
                alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              }
            });
          }
        }
      });
    });

    const fileInput = document.querySelector('#teamFile');
    const fileName = document.querySelector('#fileName');
    fileInput.addEventListener('change', () => {
      fileName.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
    });
  </script>
</body>
</html>