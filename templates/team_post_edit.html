<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WWL</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { 
        background:#f6fbf9; 
    }

    .fixed-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 35px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .wwl-label{ 
      font-size:30px; 
      font-weight:700; 
      color:#00c32e !important;
      text-decoration: none;
    }
    .top-menu {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 2000;
        display: flex;
        align-items: center;
    }
    .logout-text:hover {
        color: #ff3860;
    }
    .avatar-frame{ 
        width:72px; height:72px; border-radius:50%; 
        background-size:cover; background-position:center; 
        border:3px solid #fff; 
        box-shadow:0 2px 8px rgba(0,0,0,.2); 
    }
    .note-editor.note-frame {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
    }
    .section {
        margin-top: 70px;
        padding-top: 1rem;
    }
    
    /* 알림 드롭다운 스타일 */
    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid #dbdbdb;
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      width: 350px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 3000;
      display: none;
    }
    
    .notification-dropdown.is-active {
      display: block;
    }
    
    .notification-item {
      padding: 15px;
      border-bottom: 1px solid #f5f5f5;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .notification-item:hover {
      background-color: #f8f9fa;
    }
    
    .notification-item.is-unread {
      background-color: #e8f4fd;
      border-left: 4px solid #3273dc;
    }
    
    .notification-header {
      padding: 15px;
      border-bottom: 2px solid #f5f5f5;
      background-color: #fafafa;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .notification-empty {
      padding: 30px;
      text-align: center;
      color: #999;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      display: none;
      min-width: 20px;
      height: 20px;
      font-size: 12px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }
  </style>
</head>
<body>
    <!-- 상단 통합 네비게이션 바 -->
    <nav class="navbar is-white has-shadow is-fixed-top" style="z-index: 2000;">
        <div class="navbar-brand">
        <a class="navbar-item wwl-label" href="/main_page" style="cursor: pointer;">WeeklyWeLearned</a>
        </div>
        <div class="navbar-end">
        <div class="navbar-item">
            <div class="is-flex is-align-items-center">
            <!-- 알림 아이콘 -->
            <div class="mr-3" style="position: relative;">
              <span id="notification-icon" class="icon is-large" style="cursor: pointer; font-size: 1.5rem;" onclick="toggleNotifications()">
                <i class="fas fa-bell"></i>
              </span>
              <span id="notification-badge" class="tag is-danger is-small notification-badge">0</span>
              
              <!-- 알림 드롭다운 -->
              <div id="notification-dropdown" class="notification-dropdown">
                <div class="notification-header">
                  <h3 class="title is-6 mb-0">알림</h3>
                  <div>
                    <button class="button is-small is-text" onclick="markAllAsRead()">모두 읽음</button>
                    <button class="button is-small is-text has-text-danger" onclick="clearAllNotifications()">모두 삭제</button>
                  </div>
                </div>
                <div id="notification-list">
                  <div class="notification-empty">
                    <i class="fas fa-bell-slash has-text-grey-light"></i>
                    <p>알림이 없습니다</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 프로필 이미지와 닉네임 -->
            <div class="is-flex is-align-items-center mr-3" style="cursor: pointer;" onclick="window.location.href='/user/{{ current_user.username }}'">
                <div style="width: 32px; height: 32px; margin-right: 8px; background-image: url('/static/profile_imgs/{{ current_user.profile_img if current_user.profile_img else 'default-avatar.jpg' }}'); background-size: cover; background-position: center; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);"></div>
                <span class="has-text-weight-semibold">{{ current_user.nickname }}</span>
            </div>
            <span class="logout-text" onclick="window.location.href='/logout'" style="cursor: pointer; font-weight: 600; color: #363636;">로그아웃</span>
            </div>
        </div>
        </div>
    </nav>

  <!-- 메인 컨텐츠 -->
  <section class="section">
    <div class="container">
      
      <!-- 뒤로가기 버튼 -->
      <div class="mb-3">
        <a href="/team_page/{{ team.id }}" class="button is-small" style="background: none; border: none; box-shadow: none; padding-left: 0;">
          <span class="icon">
            <i class="fas fa-arrow-left"></i>
          </span>
          <span>팀 페이지로 돌아가기</span>
        </a>
      </div>
      
      <!-- 팀 헤더 -->
      <div class="box">
        <h1 class="title is-3">{{ team.teamName }}</h1>
        <p class="subtitle is-5 has-text-grey">{{ team.description }}</p>
      </div>

      <!-- 게시글 수정 에디터 -->
      <div class="box">
        <h2 class="title is-4 mb-3">게시글 수정</h2>
        <form method="POST" action="/edit_post">
          <input type="hidden" name="team_id" value="{{ team.id }}">
          <input type="hidden" name="post_id" value="{{ post.id }}">
          <input type="hidden" name="original_title" value="{{ post.title }}">
          
          <div class="field">
            <label class="label">작성자</label>
            <div class="control">
              <input class="input" type="text" value="{{ post.author }}" readonly>
            </div>
          </div>
          
          <div class="field">
            <label class="label">제목</label>
            <div class="control">
              <input class="input" type="text" name="title" value="{{ post.title }}" required>
            </div>
          </div>
          
          <div class="field">
            <label class="label">내용</label>
            <textarea id="editor" name="content">{{ post.content | safe }}</textarea>
          </div>
          
          <div class="control">
            <button class="button is-success mt-3" type="submit">수정 완료</button>
            <a href="/team_page/{{ team.id }}" class="button is-light mt-3 ml-2">취소</a>
          </div>
        </form>
      </div>

    </div>
  </section>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
  <script>
    // WWL 라벨 클릭 처리 함수
    function handleWWLClick() {
        if (window.location.pathname === '/main_page') {
            window.location.reload();
        } else {
            window.location.href = '/main_page';
        }
    }

    $(document).ready(function() {
      $('#editor').summernote({
        height: 400,
        lang: 'ko-KR',
        toolbar: [
          ['style', ['bold', 'italic', 'underline', 'clear']],
          ['font', ['strikethrough', 'superscript', 'subscript']],
          ['fontsize', ['fontsize']],
          ['color', ['color']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['height', ['height']],
          ['insert', ['link', 'picture', 'video']],
          ['view', ['fullscreen', 'codeview', 'help']]
        ],
        callbacks: {
          onImageUpload: function(files) {
            const formData = new FormData();
            formData.append('image', files[0]);

            // 서버에 이미지 업로드 요청
            $.ajax({
              url: '/upload_image',
              method: 'POST',
              data: formData,
              contentType: false,
              processData: false,
              success: function(data) {
                // 업로드된 이미지 URL을 에디터에 삽입
                $('#editor').summernote('insertImage', data.url);
              },
              error: function() {
                alert('이미지 업로드에 실패했습니다.');
              }
            });
          }
        }
      });
    });
  </script>
  <script src="/static/alarm.js"></script>
</body>
</html>